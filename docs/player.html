<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <title>Unity Web Player | My project</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">
  <style>
    html,body{height:100%;margin:0;overflow:hidden;background:#000;overscroll-behavior:none;touch-action:none;}
    #stage{position:fixed;inset:0;display:grid;place-items:center;touch-action:none;}
    .fit16x9{width:min(100dvw,calc(100dvh*16/9));height:min(100dvh,calc(100dvw*9/16));touch-action:none;}
    #unity-canvas{
      width:100% !important;height:100% !important;display:block;background:#231f20;
      touch-action:none;-ms-touch-action:none;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;
    }
    *{-webkit-tap-highlight-color:transparent}

    /* Loader overlay */
    #loader{position:fixed;inset:0;display:grid;place-items:center;background:#0b0b0b;z-index:9999;}
    .card{width:min(90vw,360px);padding:16px 18px;text-align:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#e6e6e6;}
    .bar{height:10px;background:#1e1e1e;border-radius:999px;overflow:hidden}
    .fill{height:100%;width:0%}
    .t{margin:0 0 10px 0;font-size:14px;opacity:.9}
    .p{margin-top:8px;font-size:12px;opacity:.8}
  </style>
</head>
<body>
  <div id="stage">
    <div class="fit16x9">
      <canvas id="unity-canvas" tabindex="-1"></canvas>
    </div>
  </div>

  <div id="loader">
    <div class="card">
      <p class="t">Loadingâ€¦</p>
      <div class="bar"><div class="fill" id="fill" style="background:linear-gradient(90deg,#4dc0ff,#2eaadc)"></div></div>
      <div class="p" id="pct">0%</div>
    </div>
  </div>

  <script>
    // unity config
    const buildUrl  = "Build";
    const loaderUrl = buildUrl + "/Medi.loader.js";
    const config = {
      arguments: [],
      dataUrl:      buildUrl + "/Medi.data",
      frameworkUrl: buildUrl + "/Medi.framework.js",
      codeUrl:      buildUrl + "/Medi.wasm",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "My project",
      productVersion: "0.1.0",
      matchWebGLToCanvasSize: true
      // devicePixelRatio: 1, // uncomment to lower render res on phones
    };

    // progress UI refs
    const canvas = document.getElementById("unity-canvas");
    const loader = document.getElementById("loader");
    const fill = document.getElementById("fill");
    const pct  = document.getElementById("pct");

    // Strict viewport (in case host overrides later)
    (function enforceViewport(){
      const desired="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover";
      let m=document.querySelector('meta[name="viewport"]');
      if(!m){m=document.createElement("meta");m.name="viewport";document.head.appendChild(m);}
      m.setAttribute("content",desired);
    })();

    // ANDROID HARD BLOCKS: stop browser from stealing gestures
    (function passTouchesToUnity(){
      const el = canvas;

      // Prevent default on touch events using non-passive listeners
      ["touchstart","touchmove","touchend","touchcancel"].forEach(t=>{
        el.addEventListener(t, e => { e.preventDefault(); }, { passive:false });
      });

      // Capture pointer so move/ups stay on canvas even if finger leaves bounds
      el.addEventListener("pointerdown", e => {
        try { el.setPointerCapture(e.pointerId); } catch(_) {}
      }, { passive:true });

      // Extra safety against double-tap zoom or browser gestures on some Android shells
      document.addEventListener("gesturestart", e => e.preventDefault(), { passive:false });
      document.addEventListener("gesturechange", e => e.preventDefault(), { passive:false });
      document.addEventListener("gestureend", e => e.preventDefault(), { passive:false });

      // Optional: block page scroll if any wheel events occur
      document.addEventListener("wheel", e => e.preventDefault(), { passive:false });
    })();

    // load Unity
    const s=document.createElement("script");
    s.src=loaderUrl;
    s.onload=() => {
      createUnityInstance(canvas, config, (progress)=>{
        const p=Math.round(progress*100);
        fill.style.width=p+"%";
        pct.textContent=p+"%";
      }).then(()=>{
        loader.style.display="none";
      }).catch((e)=>{
        loader.style.display="none";
        alert(e);
      });
    };
    document.body.appendChild(s);
  </script>
</body>
</html>
